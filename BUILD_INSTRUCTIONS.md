# Инструкция по созданию дистрибутива для MacOS

Эта инструкция поможет вам создать дистрибутив приложения Test Case Editor для MacOS, который можно запускать двойным кликом.

## Требования

1. **MacOS** (любая версия с поддержкой Python 3)
2. **Python 3.7+** (проверьте командой: `python3 --version`)
3. **pip** (обычно устанавливается вместе с Python)

## Установка зависимостей

Перед сборкой убедитесь, что все зависимости установлены:

```bash
pip3 install -r requirements.txt
pip3 install pyinstaller
```

## Сборка дистрибутива

### Автоматическая сборка (рекомендуется)

1. Откройте Terminal (Терминал)
2. Перейдите в папку проекта:
   ```bash
   cd /Users/utb404/work/projects/viewer_testcase
   ```
3. Сделайте скрипт исполняемым (если еще не сделано):
   ```bash
   chmod +x build_macos.sh
   ```
4. Запустите скрипт сборки:
   ```bash
   ./build_macos.sh
   ```

Скрипт автоматически:
- Проверит наличие всех необходимых инструментов
- Установит PyInstaller, если его нет
- Очистит предыдущие сборки
- Создаст конфигурационный файл `app.spec` (если его нет)
- Соберет приложение
- Поместит результат в папку `dist/`

### Ручная сборка

Если вы предпочитаете собрать вручную:

1. Создайте конфигурационный файл (если его нет):
   ```bash
   python3 -m PyInstaller --name "Test Case Editor" \
       --windowed \
       --onedir \
       --add-data "icons:icons" \
       --hidden-import PyQt5.QtSvg \
       run_app.py
   ```

2. Или используйте существующий `app.spec`:
   ```bash
   python3 -m PyInstaller app.spec --clean
   ```

## Результат сборки

После успешной сборки вы найдете приложение по пути:
```
dist/Test Case Editor.app
```

## Запуск приложения

### Способ 1: Через Finder
1. Откройте папку `dist` в Finder
2. Дважды кликните на `Test Case Editor.app`

### Способ 2: Через Terminal
```bash
open "dist/Test Case Editor.app"
```

### Способ 3: Перетаскивание в Applications
1. Откройте папку `dist` в Finder
2. Перетащите `Test Case Editor.app` в папку `Applications`
3. Запустите из Launchpad или Spotlight

## Создание DMG архива (опционально)

Для распространения приложения можно создать DMG файл:

```bash
hdiutil create -volname "Test Case Editor" \
    -srcfolder "dist/Test Case Editor.app" \
    -ov -format UDZO \
    "dist/Test Case Editor.dmg"
```

DMG файл будет создан в папке `dist/` и его можно распространять.

## Устранение проблем

### Ошибка: "Python3 не найден"
- Установите Python 3 с [python.org](https://www.python.org/downloads/) или через Homebrew:
  ```bash
  brew install python3
  ```

### Ошибка: "PyInstaller не установлен"
- Установите вручную:
  ```bash
  pip3 install pyinstaller
  ```

### Ошибка: "Иконки не загружаются"
- Убедитесь, что папка `icons` находится в корне проекта
- Проверьте, что в `app.spec` есть строка: `('icons', 'icons')`
- Если проблема сохраняется, используйте утилиту `test_case_editor/utils/resource_path.py` для определения путей к ресурсам в коде приложения

### Ошибка: "Приложение не запускается"
- Проверьте логи в Terminal при запуске через:
  ```bash
  "dist/Test Case Editor.app/Contents/MacOS/Test Case Editor"
  ```
- Убедитесь, что все зависимости установлены

### Предупреждение безопасности MacOS

При первом запуске MacOS может показать предупреждение о том, что приложение не может быть открыто, так как оно от неизвестного разработчика.

**Решение:**
1. Откройте **Системные настройки** → **Безопасность и конфиденциальность**
2. Нажмите **"Открыть в любом случае"** рядом с предупреждением
3. Или удерживайте `Control`, кликните на приложение и выберите **"Открыть"**

### Подпись приложения (для распространения)

Если вы планируете распространять приложение, рекомендуется подписать его:

```bash
codesign --deep --force --verify --verbose \
    --sign "Developer ID Application: Your Name" \
    "dist/Test Case Editor.app"
```

Для этого вам понадобится сертификат разработчика Apple.

## Структура сборки

После сборки структура будет следующей:

```
dist/
└── Test Case Editor.app/
    ├── Contents/
    │   ├── Info.plist
    │   ├── MacOS/
    │   │   └── Test Case Editor (исполняемый файл)
    │   ├── Resources/
    │   │   ├── icons/          # Все иконки из папки icons
    │   │   │   ├── *.svg
    │   │   │   └── icon_mapping.json
    │   │   └── settings.json   # Если существует
    │   └── ...
```

## Что включено в сборку

- ✅ Все Python модули из `test_case_editor/`
- ✅ Папка `icons/` со всеми SVG иконками
- ✅ Файл `icon_mapping.json`
- ✅ Файл `settings.json` (если существует)
- ✅ Все зависимости PyQt5
- ✅ Все зависимости из `requirements.txt`

## Дополнительная информация

- Версия приложения: 2.0.0
- Минимальная версия MacOS: 10.13 (High Sierra)
- Размер сборки: ~50-100 MB (зависит от зависимостей)

## Поддержка

При возникновении проблем проверьте:
1. Логи сборки в Terminal
2. Логи запуска приложения
3. Версии Python и PyInstaller
4. Наличие всех файлов в проекте

